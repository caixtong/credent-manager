parameters:
  name: ''
  vmImage: ''

jobs:
- job: ${{ parameters.name }}
  pool:
    vmImage: ${{ parameters.vmImage }}

  steps:
  - task: DotNetCoreInstaller@0
    displayName: Use .NET Core SDK 2.1.301
    inputs:
      packageType: sdk
      version: '2.1.301'

  - task: DotNetCoreCLI@2
    displayName: Compile
    inputs:
      command: build
      projects: 'Git-Credential-Manager.sln'
      arguments: '--configuration=$(configuration)'

  - task: DotNetCoreCLI@2
    displayName: Run unit tests
    inputs:
      command: test
      projects: 'tests/**/*.csproj'
      arguments: '--logger=trx'
      publishTestResults: false # Need to manually publish to set custom test run titles
      continueOnError: true

  - task: PublishTestResults@2
    displayName: Publish test results
    inputs:
      testResultsFormat: VSTest
      testResultsFiles: '**/*.trx'
      testRunTitle: '${{ parameters.name }} unit tests'
    condition: succeededOrFailed()
